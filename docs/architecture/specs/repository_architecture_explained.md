# Repository Architecture â€” How Mozaiks Code Distribution Works

**Date:** 2026-01-07  
**Audience:** Founders trying to understand where repos live and how the open-source model works

---

## CRITICAL CLARIFICATION: They're BOTH Runtimes!

### Why the Confusion?

You're absolutely right to be confused. **Both MozaiksAI and MozaiksCore are runtimes** - they both execute code. The difference is **what type of code** they execute and **when**.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MozaiksAI = WORKFLOW ORCHESTRATION RUNTIME                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

What it executes: Workflow definitions (.yml files) + tool scripts (.py, .js)
Purpose: Orchestrate multi-step AI tasks, generate code, automation
When: During Build/Earn/Grow wizard interactions
Analogous to: Temporal.io, Airflow, AWS Step Functions, Zapier

Example workflow:
---
# workflows/AppGenerator/workflow.yml
name: AppGenerator
steps:
  - analyze_requirements:
      model: gpt-4
  - generate_frontend:
      template: react-typescript
  - generate_backend:
      template: python-fastapi
---

The MozaiksAI runtime:
  â”œâ”€ Loads this .yml at startup
  â”œâ”€ Executes steps when user sends chat message
  â”œâ”€ Orchestrates between AI, tools, and services
  â””â”€ Produces output (generated app code)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MozaiksCore = APPLICATION FRAMEWORK + RUNTIME                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

What it executes: User's app business logic (.py, .js, .ts files)
Purpose: Run the generated app, provide auth/payments/hosting services
When: When end-users interact with the deployed app
Analogous to: Django, Express.js, Ruby on Rails, ASP.NET Core

Example app code:
---
# user123/my-app/backend/tasks.py
from mozaiks_core_runtime import auth, db

@auth.require_user  # â† MozaiksCore provides this
def create_task(request):
    user = auth.current_user()  # â† MozaiksCore provides this
    task = db.tasks.create(  # â† MozaiksCore provides this
        title=request.data['title'],
        owner=user.id
    )
    return {"id": task.id}
---

The MozaiksCore runtime:
  â”œâ”€ Starts HTTP server
  â”œâ”€ Handles incoming requests
  â”œâ”€ Provides auth, db, payment services
  â””â”€ Executes user's business logic
```

---

## The Key Differences

| Aspect | MozaiksAI (Workflow Runtime) | MozaiksCore (App Runtime) |
|--------|------------------------------|---------------------------|
| **Executes** | Workflow definitions (.yml) + tool scripts | App business logic (.py, .js, .ts) |
| **Purpose** | Orchestrate AI tasks, generate code | Execute user-facing web apps |
| **When** | During Build/Earn/Grow wizard | When end-users use deployed app |
| **Users write** | Declarative YAML + optional Python tools | Imperative Python/JS app code |
| **Like** | Temporal.io, Airflow, GitHub Actions | Django, Express.js, Rails |
| **Is it a runtime?** | âœ… YES (workflow orchestration) | âœ… YES (app execution environment) |
| **Is it an SDK?** | âŒ NO (it's a service) | âœ… YES (also imported as library) |

---

## Why Both Have .py/.js Files

**MozaiksAI workflow tools (.py):**
```python
# workflows/AppGenerator/tools/code_generator.py
def generate_react_component(name, props):
    # Tool used BY workflow to generate code
    return f"export const {name} = ({props}) => {{ ... }}"
```
**Purpose:** Helper functions for the workflow itself  
**Runs on:** MozaiksAI runtime during code generation

**MozaiksCore app code (.py):**
```python
# user123/my-app/backend/api.py
from mozaiks_core_runtime import auth

@auth.require_user
def get_tasks():
    # User's business logic (generated by AppGenerator)
    return Task.objects.filter(owner=request.user)
```
**Purpose:** The actual app that end-users interact with  
**Runs on:** MozaiksCore runtime in production

---

## The Relationship

```
MozaiksAI Runtime (Workflow Orchestration)
        â”‚
        â”‚ Executes AppGenerator workflow
        â”‚ Produces:
        â–¼
Generated App Code (frontend/ + backend/)
        â”‚
        â”‚ This code imports:
        â”‚ from mozaiks_core_runtime import auth
        â–¼
MozaiksCore Runtime (App Execution)
        â”‚
        â”‚ Runs the generated app
        â”‚ Provides auth, payments, hosting services
        â–¼
End-users interact with deployed app
```

**MozaiksAI creates the app.**  
**MozaiksCore runs the app.**

---

## Updated Repo Descriptions

| Repo | Type | What It Is | Best Analogy |
|------|------|------------|--------------|
| **mozaiks-ai** | Workflow Orchestration Runtime | Executes workflow definitions to generate code | Temporal.io, GitHub Actions |
| **mozaiks-core** | Application Framework + Runtime | Executes generated app code, provides services | Django, Express.js |
| **mozaiks-workflows** | Workflow Definitions (YAML + tools) | Your 5 proprietary workflow definitions | GitHub Actions workflows/ folder |
| **user123/my-app** | Generated Application | User's app code (runs on MozaiksCore) | A Django project, Express app |

**Both are runtimes, but:**
- MozaiksAI orchestrates **workflow execution** (generates things)
- MozaiksCore executes **application code** (runs things)

---

## Your Actual Workflow Architecture (Mozaiks Platform)

### The 5 Core Workflows (Run on MozaiksAI Runtime)

| Workflow | What It Generates | Runs On |
|----------|-------------------|---------|
| **ValueEngine** | Ideas, adjustments | MozaiksAI Runtime |
| **DesignDocument** | Design docs, alignment updates | MozaiksAI Runtime |
| **AgentGenerator** | Agent definitions (.json, .py, .js) | MozaiksAI Runtime â†’ Outputs used BY MozaiksAI |
| **AppGenerator** | App code (.json, .py, .js) | MozaiksAI Runtime â†’ Outputs run ON MozaiksCore |
| **ValidationEngine** | Marketing content, ad campaign data | MozaiksAI Runtime â†’ Consumed by .NET backend |

**Key Insight:** All 5 workflows execute on **MozaiksAI runtime**. The outputs then go to different destinations:
- AgentGenerator outputs â†’ Used by MozaiksAI runtime for agentic capabilities
- AppGenerator outputs â†’ Run on MozaiksCore runtime (the generated app)
- ValidationEngine outputs â†’ Consumed by .NET backend (BlocUnitedMicroservice)

---

## Your Current Repo Structure (January 2026)

### Repos for Running Mozaiks Platform

```
GitHub Organization: Mozaiks

1. BlocUnitedMicroservice/
   â”œâ”€â”€ Purpose: .NET backend (control plane)
   â”œâ”€â”€ Services: Auth, Payment, Governance, ValidationEngine, etc.
   â””â”€â”€ Port: 8010 (Ocelot gateway)

2. MOZ-UI/
   â”œâ”€â”€ Purpose: Frontend UI for Mozaiks platform
   â”œâ”€â”€ Tech: React/Next.js
   â””â”€â”€ Needs: MozaiksAI ChatWidget integration

3. MozaiksAI/
   â”œâ”€â”€ Purpose: AI workflow runtime + ChatUI
   â”œâ”€â”€ Contains:
   â”‚   â”œâ”€â”€ workflows/           â† Your 5 workflows live here
   â”‚   â”‚   â”œâ”€â”€ ValueEngine/
   â”‚   â”‚   â”œâ”€â”€ DesignDocument/
   â”‚   â”‚   â”œâ”€â”€ AgentGenerator/
   â”‚   â”‚   â”œâ”€â”€ AppGenerator/
   â”‚   â”‚   â””â”€â”€ ValidationEngine/
   â”‚   â”œâ”€â”€ runtime/             â† MozaiksAI runtime engine
   â”‚   â””â”€â”€ chatui/              â† Chat widget UI
   â””â”€â”€ Executes: All 5 workflows

4. MozaiksCore/
   â”œâ”€â”€ Purpose: Runtime for GENERATED apps
   â”œâ”€â”€ Status: Empty shell (not used by Mozaiks platform itself)
   â””â”€â”€ Used by: Apps created by AppGenerator workflow
```

---

## Final Repo Structure (When Fully Functional)

### Repos You'll Have

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 MOZAIKS PLATFORM (Your SaaS)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. mozaiks-backend (formerly BlocUnitedMicroservice)
   â”œâ”€â”€ .NET microservices
   â”œâ”€â”€ Auth, Payment, Governance, ValidationEngine, etc.
   â””â”€â”€ Consumes outputs from ValidationEngine workflow

2. mozaiks-frontend (formerly MOZ-UI)
   â”œâ”€â”€ React/Next.js UI
   â”œâ”€â”€ Integrated MozaiksAI ChatWidget
   â””â”€â”€ User-facing platform interface

3. mozaiks-ai (formerly MozaiksAI)
   â”œâ”€â”€ Workflow runtime engine
   â”œâ”€â”€ Your 5 core workflows
   â”œâ”€â”€ ChatUI/ChatWidget
   â”œâ”€â”€ Agent execution system
   â””â”€â”€ Public/open-source

4. mozaiks-core (formerly MozaiksCore)
   â”œâ”€â”€ App runtime for GENERATED apps
   â”œâ”€â”€ Auth, payments, hosting SDKs
   â”œâ”€â”€ NOT used by Mozaiks platform itself
   â””â”€â”€ Public/open-source

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            USER'S GENERATED APPS (Per-User Repos)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. user123/my-saas-app (Generated by AppGenerator)
   â”œâ”€â”€ frontend/              â† Runs ON mozaiks-core runtime
   â”œâ”€â”€ backend/               â† Runs ON mozaiks-core runtime
   â”œâ”€â”€ workflows/             â† Custom workflows (run on mozaiks-ai)
   â”‚   â””â”€â”€ notifications.yml
   â””â”€â”€ agents/                â† Custom agents (run on mozaiks-ai)
       â””â”€â”€ support-bot.json
```

---

## The Confusion: Which Workflows Run Where?

### âŒ INCORRECT Understanding
"Workflows run on MozaiksCore" â†’ **NO**

### âœ… CORRECT Understanding

| Component | Runs On | Example |
|-----------|---------|---------|
| **Your 5 Mozaiks workflows** | MozaiksAI runtime | ValueEngine, DesignDocument, etc. |
| **Generated app code** | MozaiksCore runtime | React frontend, Python backend |
| **Generated workflow definitions** | MozaiksAI runtime | User's custom workflows (notifications.yml) |
| **Generated agent definitions** | MozaiksAI runtime | User's custom agents (support-bot.json) |

**MozaiksCore does NOT execute workflows.** It executes app code (frontend/backend).  
**MozaiksAI executes ALL workflows** (yours + user's custom ones).

---

## The Real Interaction Flow

```
User talks to ChatUI (in MOZ-UI)
        â”‚
        â–¼
ChatUI sends message to MozaiksAI Runtime
        â”‚
        â–¼
MozaiksAI executes your workflows:
  â”œâ”€â”€ ValueEngine â†’ Creates ideas
  â”œâ”€â”€ DesignDocument â†’ Creates design docs
  â”œâ”€â”€ AgentGenerator â†’ Creates agent .json/.py/.js
  â”œâ”€â”€ AppGenerator â†’ Creates app .json/.py/.js
  â””â”€â”€ ValidationEngine â†’ Creates marketing content
        â”‚
        â–¼
Outputs are sent to different places:
  â”œâ”€â”€ Agent files â†’ Stay in MozaiksAI (used for agentic behavior)
  â”œâ”€â”€ App files â†’ Backend stores temporarily
  â””â”€â”€ Marketing content â†’ ValidationEngine.API consumes
        â”‚
        â–¼
User clicks "Deploy"
        â”‚
        â–¼
Backend creates GitHub repo for user:
  github.com/user123/my-app/
  â”œâ”€â”€ frontend/  â† Runs on MozaiksCore runtime
  â”œâ”€â”€ backend/   â† Runs on MozaiksCore runtime
  â””â”€â”€ workflows/ â† Run on MozaiksAI runtime
        â”‚
        â–¼
User's app is deployed:
  â”œâ”€â”€ MozaiksCore runtime executes their app code
  â””â”€â”€ MozaiksAI runtime executes their workflow definitions
```

---

## The Question

> "Will MozaiksAI be a public open-source repo with nothing in the workflow folders? Will MozaiksCore be an open-source repo with nothing in the plugin folders? Do users fork it? Copy/paste? How does this all work?"

---

## The Answer (Simple Version)

You have **3 different repo types** in the Mozaiks ecosystem:

| Repo Type | What It Is | Who Owns It | Public or Private | How Users Get It |
|-----------|------------|-------------|-------------------|------------------|
| **MozaiksAI Runtime** | Workflow runtime system (runs Build/Earn/Grow workflows + generates code) | You (Mozaiks) | Public (open-source) | Users connect to it as a service OR self-host |
| **MozaiksCore Runtime** | App runtime system (executes the generated app files) | You (Mozaiks) | Public (open-source) | Generated apps run ON TOP OF this |
| **User's Generated App** | App code + workflow definitions (needs both runtimes to execute) | The user | Private (user's repo) | Backend generates it, user gets a zip or GitHub repo |

---

## How It Works (Detailed Flow)

### Phase 1: User Builds App with MozaiksAI

```
User interacts with MozaiksAI Chat
        â”‚
        â–¼
MozaiksAI workflows generate code files
(React frontend, Python backend, MongoDB schemas, workflow definitions, etc.)
        â”‚
        â–¼
Backend stores generated code temporarily
(In-memory or temp storage, not in a public repo)
```

**Key point:** The generated code is **user-specific** and **runtime-dependent**:
- App files need **MozaiksCore runtime** to execute
- Workflow files need **MozaiksAI runtime** to execute
- It's not standalone code - it's code that runs on these runtime systems

---

### Phase 2: User Deploys (3 Options)

#### Option A: Export as Zip (Build-Only Plan)

```
User clicks "Export Repo"
        â”‚
        â–¼
Backend zips up the generated code
        â”‚
        â–¼
User downloads: my_app.zip
        â”‚
        â–¼
User manually:
  - Unzips it
  - Pushes to their own GitHub repo
  - Deploys to their own hosting (Vercel, Railway, etc.)
```

**User's repo structure:**
```
my-cool-app/          â† User creates this repo themselves
â”œâ”€â”€ frontend/         â† Generated by MozaiksAI, runs on MozaiksCore runtime
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json  â† Includes @mozaiks/core-runtime
â”‚   â””â”€â”€ ...
â”œâ”€â”€ backend/          â† Generated by MozaiksAI, runs on MozaiksCore runtime
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ requirements.txt  â† Includes mozaiks-core-runtime
â”‚   â””â”€â”€ ...
â”œâ”€â”€ workflows/        â† Generated workflow definitions, run on MozaiksAI runtime
â”‚   â”œâ”€â”€ onboarding.yml
â”‚   â””â”€â”€ automation.yml
â”œâ”€â”€ .env.example      â† Generated by MozaiksAI
â”œâ”€â”€ docker-compose.yml â† Generated by MozaiksAI (includes MozaiksCore runtime)
â””â”€â”€ README.md         â† Generated by MozaiksAI
```

---

#### Option B: Mozaiks Creates GitHub Repo For Them (Coming Soon)

```
User clicks "Deploy" (with hosting plan)
        â”‚
        â–¼
Backend calls GitHub API on user's behalf
        â”‚
        â–¼
Creates repo: github.com/user123/my-cool-app
        â”‚
        â–¼
Pushes generated code to that repo
        â”‚
        â–¼
User now has a private GitHub repo with all their code
```

**User owns the repo.** They can clone it, modify it, push changes â€” it's theirs.

---

#### Option C: Bring Your Own Azure (BYO Hosting)

```
User connects their Azure subscription to Mozaiks
        â”‚
        â–¼
User clicks "Deploy"
        â”‚
        â–¼
Backend deploys to user's Azure Container Apps
        â”‚
        â–¼
App is live at: my-cool-app.azurecontainerapps.io
```

**User's repo (optional):**  
They can still export the code to see what's running. The deployment happens from the backend's temp storage.

---

## Where Do MozaiksAI and MozaiksCore Fit?

### MozaiksAI Runtime (Public Open-Source)

**What it is:**
- **Workflow runtime system** that executes Build/Earn/Grow wizards
- Also generates code via AI agents
- Executes workflow definitions (`.yml` files) in generated apps
- Users connect to it (managed mode) OR self-host it (self-hosted mode)

**Repo contents:**
```
MozaiksAI/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ wizards/          â† Build/Earn/Grow logic
â”‚   â”œâ”€â”€ workflows/        â† Empty or minimal (YOU provide via plugins)
â”‚   â””â”€â”€ tools/            â† API integrations (ValidationEngine, etc.)
â”œâ”€â”€ tests/
â”œâ”€â”€ README.md
â””â”€â”€ LICENSE (MIT or Apache 2.0)
```

**Key point:** The `workflows/` folder contains the core workflow execution engine. Generated apps create workflow definition files (`.yml`) that MozaiksAI runtime executes.

**Users don't fork MozaiksAI.** They either:
- **Managed mode:** Connect their app to Mozaiks-hosted runtime (like using AWS Lambda)
- **Self-hosted mode:** Run MozaiksAI runtime in their own infrastructure

---

### MozaiksCore Runtime (Public Open-Source)

**What it is:**
- **Application runtime system** that executes generated app code
- Not just a library â€” it's the execution environment
- Provides auth, payments, hosting, data access as runtime services
- Generated apps run **ON TOP OF** MozaiksCore (like apps run on Node.js or Django)

**Repo contents:**
```
MozaiksCore/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ auth/             â† JWT validation, user context
â”‚   â”œâ”€â”€ payments/         â† MozaiksPay connector
â”‚   â”œâ”€â”€ insights/         â† KPI telemetry
â”‚   â””â”€â”€ hosting/          â† Environment detection (managed vs self-hosted)
â”œâ”€â”€ plugins/              â† Empty or examples (users can add custom plugins)
â”œâ”€â”€ tests/
â”œâ”€â”€ README.md
â””â”€â”€ LICENSE (MIT)
```

**How users deploy it:**

**In a React app (frontend):**
```json
// package.json
{
  "dependencies": {
    "@mozaiks/core-runtime": "^1.0.0"  â† Runtime, not just a library
  }
}
```

**In a Python app (backend):**
```python
# requirements.txt
mozaiks-core-runtime==1.0.0  â† Runtime environment
```

**Deployment options:**
- **Managed mode:** Mozaiks hosts the runtime (like Vercel hosts Next.js)
- **Self-hosted mode:** User runs MozaiksCore runtime in their infrastructure
- **Users don't fork MozaiksCore** â€” they run it as a runtime environment

---

## The "Fork vs Copy" Question

| Scenario | Do They Fork? | Do They Copy/Paste? | What Actually Happens |
|----------|---------------|---------------------|------------------------|
| **MozaiksAI Runtime** | âŒ No | âŒ No | They don't touch it â€” runs as a service |
| **MozaiksCore SDK** | âŒ No | âŒ No | They install it as a dependency (npm/pip) |
| **Generated App Code** | âŒ No | âš ï¸ Sort of | Backend generates it, they get a zip or repo |

**Important:** Generated apps are **not forks**. They're **new repos** created from scratch by the AI.

---

## What's In The Workflow Folders?

### MozaiksAI `workflows/`

**Option 1: Minimal Core (Recommended)**
```
MozaiksAI/
â””â”€â”€ workflows/
    â””â”€â”€ README.md  â† "Workflows are loaded as plugins"
```

**Option 2: Platform-Provided Defaults**
```
MozaiksAI/
â””â”€â”€ workflows/
    â”œâ”€â”€ onboarding/
    â”‚   â””â”€â”€ setup_account.yml
    â””â”€â”€ deployment/
        â””â”€â”€ azure_deploy.yml
```

**Users extend this via:**
- Uploading custom workflow definitions to Mozaiks
- Installing community workflow packs

---

### MozaiksCore `plugins/`

**Option 1: Minimal Core (Recommended)**
```
MozaiksCore/
â””â”€â”€ plugins/
    â””â”€â”€ README.md  â† "Plugins enable custom auth/payment providers"
```

**Option 2: Example Plugins**
```
MozaiksCore/
â””â”€â”€ plugins/
    â”œâ”€â”€ auth/
    â”‚   â””â”€â”€ firebase_auth.py  â† Example: Use Firebase instead of Mozaiks Auth
    â””â”€â”€ payments/
        â””â”€â”€ paypal.py  â† Example: Use PayPal instead of Stripe
```

**Users extend this by:**
- Implementing the plugin interfaces in their own code
- Not modifying MozaiksCore itself

---

## The User's Experience (End-to-End)

### Scenario: Jane wants to build a task tracker app

1. **Jane talks to MozaiksAI:**
   - "Build me a task tracker with React and Python backend"
   - MozaiksAI generates all the code (AI-driven, not from a template)

2. **Jane clicks "Deploy":**
   - **If she has a build-only plan:** Downloads `task-tracker.zip`
   - **If she has a hosting plan:** Backend creates GitHub repo OR deploys to Azure

3. **Jane's repo (if created):**
   ```
   github.com/jane/task-tracker  â† New repo, created by Mozaiks backend
   â”œâ”€â”€ frontend/                 â† React app (runs on MozaiksCore runtime)
   â”œâ”€â”€ backend/                  â† Python API (runs on MozaiksCore runtime)
   â”œâ”€â”€ workflows/                â† Workflow definitions (run on MozaiksAI runtime)
   â”‚   â””â”€â”€ notifications.yml
   â”œâ”€â”€ docker-compose.yml        â† Includes MozaiksCore runtime
   â””â”€â”€ README.md                 â† Generated by AI
   ```

4. **Jane's code runs on MozaiksCore runtime:**
   ```python
   # backend/main.py (generated)
   from mozaiks_core_runtime import auth, payments  â† Runtime services
   
   @auth.require_user
   def create_task():
       # Jane's app logic (generated by AI)
       # Executes within MozaiksCore runtime environment
       pass
   ```

5. **Jane's workflow definitions run on MozaiksAI runtime:**
   ```yaml
   # workflows/notifications.yml (generated)
   name: Send Task Notifications
   trigger: task.created
   steps:
     - send_email:  # Executed by MozaiksAI runtime
         to: "{{ task.assignee.email }}"
   ```

6. **Jane deploys the whole stack:**
   - **App code** â†’ Runs on MozaiksCore runtime (managed or self-hosted)
   - **Workflow definitions** â†’ Execute on MozaiksAI runtime (managed or self-hosted)
   - She never modifies MozaiksAI or MozaiksCore repos â€” just connects to them

---

## Common Misconceptions

| Misconception | Reality |
|---------------|---------|
| "Users fork MozaiksAI to get their app" | âŒ No â€” MozaiksAI generates code, users don't fork it |
| "MozaiksCore is a template they copy" | âŒ No â€” it's a library they install via npm/pip |
| "Generated apps are stored in Mozaiks repos" | âŒ No â€” each user gets their own repo/zip |
| "Workflows folder must be full" | âŒ No â€” can be empty, loaded as plugins at runtime |

---

## How This Compares To Other Platforms

### Vercel (v0.dev)
- **Similar:** AI generates code, you download it
- **Different:** Vercel doesn't have a "Core SDK" â€” you just get raw Next.js

### Retool
- **Similar:** No-code builder, you don't own the repo
- **Different:** Mozaiks gives you the actual code (exportable)

### Firebase + FlutterFlow
- **Similar:** Firebase SDK is a dependency, FlutterFlow generates Flutter code
- **Different:** Mozaiks gives you full backend + frontend + infra

---

## Current State (January 2026)

| Component | Status | Next Step |
|-----------|--------|-----------|
| **MozaiksAI Runtime** | âœ… Exists (this backend) | Separate into standalone service |
| **MozaiksCore SDK** | âš ï¸ Not yet published | Extract from generated code, publish to npm/pypi |
| **Generated App Repos** | âš ï¸ ZIP export works | Add GitHub repo creation via API |
| **BYO Azure Deploy** | ğŸš§ In progress | Connect user Azure subscriptions |

---

## Final Answer To Your Question

> **"Do they fork it? Do they copy and paste?"**

**Neither.**

1. **MozaiksAI:** They never touch this repo â€” it's a service they use (like ChatGPT)
2. **MozaiksCore:** They install it as a dependency (like React or Flask)
3. **Their app:** Backend generates it, they get:
   - A **ZIP file** to download, OR
   - A **GitHub repo** created for them, OR
   - An **Azure deployment** (code stays on backend, they just get the URL)

**Each user has ONE repo for their app** â€” but it's a **new repo**, not a fork. The AI generates all the code from scratch based on their conversation.

---

## Recommendation: Next Documentation

Create these docs next:
1. **`mozaikscore_sdk_spec.md`** â€” What goes in the MozaiksCore library
2. **`generated_app_structure.md`** â€” Standard folder structure for generated apps
3. **`workflow_plugin_system.md`** â€” How users extend MozaiksAI workflows

---

## Critical Clarifications (Your Actual Setup)

### What You Use For Mozaiks Platform

| Component | Do You Use It? | Purpose |
|-----------|----------------|---------|
| **MozaiksAI** | âœ… YES | Your 5 workflows run here, ChatUI lives here |
| **MozaiksCore** | âŒ NO | You DON'T use this for Mozaiks platform itself |
| **.NET Backend** | âœ… YES | Your control plane (auth, payments, governance) |
| **MOZ-UI** | âœ… YES | Your frontend (needs ChatWidget from MozaiksAI) |

### What Your Users Use

| Component | Do They Use It? | Purpose |
|-----------|-----------------|---------|
| **MozaiksAI** | âœ… YES | Executes their custom workflows + agents |
| **MozaiksCore** | âœ… YES | Runs their generated app code |
| **.NET Backend** | âœ… YES (indirectly) | Auth, payments, hosting via API |
| **MOZ-UI** | âŒ NO | They don't use your UI, they use their own app |

### The Repos You'll Have at Full Functionality

**4 Core Platform Repos:**
1. `mozaiks-backend` â†’ .NET microservices (private, your IP)
2. `mozaiks-frontend` â†’ React UI with ChatWidget (private, your IP)
3. `mozaiks-ai` â†’ Workflow runtime + your 5 workflows (public open-source)
4. `mozaiks-core` â†’ App runtime for generated apps (public open-source)

**N User Repos (created on-demand):**
- `user1/app1` â†’ Generated by AppGenerator, runs on mozaiks-core
- `user2/app2` â†’ Generated by AppGenerator, runs on mozaiks-core
- ...

### What Gets Open-Sourced vs What Stays Private

```
PUBLIC (Open-Source):
  â”œâ”€â”€ mozaiks-ai         â† Runtime engine ONLY (workflows/ folder is empty)
  â””â”€â”€ mozaiks-core       â† App runtime (SDK + runtime services)

PRIVATE (Your IP - Never Open-Sourced):
  â”œâ”€â”€ mozaiks-backend    â† .NET backend + business logic
  â”œâ”€â”€ mozaiks-frontend   â† React UI + brand/UX
  â””â”€â”€ mozaiks-workflows  â† Your 5 proprietary workflows
      (ValueEngine, DesignDocument, AgentGenerator, AppGenerator, ValidationEngine)
```

### How You'll Keep Workflows Private (Your Open-Source Strategy)

**Your Plan: Workflow-Agnostic Open Source**

```
mozaiks-ai/              â† PUBLIC (open-source, workflow runtime engine)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ runtime/         â† Workflow execution engine
â”‚   â”œâ”€â”€ chatui/          â† Chat widget components
â”‚   â”œâ”€â”€ tools/           â† Tool integrations (ValidationEngine API, etc.)
â”‚   â””â”€â”€ plugin-system/   â† Workflow plugin loader
â”œâ”€â”€ workflows/           â† EMPTY (workflow-agnostic)
â”‚   â””â”€â”€ README.md        â† "Load workflows via plugin system"
â””â”€â”€ examples/
    â””â”€â”€ hello-world/     â† Simple example workflow

mozaiks-workflows/       â† PRIVATE (your IP, proprietary workflow definitions only)
â”œâ”€â”€ ValueEngine/
â”‚   â”œâ”€â”€ workflow.yml     â† Workflow definition
â”‚   â”œâ”€â”€ prompts/         â† Proprietary prompts
â”‚   â””â”€â”€ tools.json       â† Tool configurations
â”œâ”€â”€ DesignDocument/
â”‚   â”œâ”€â”€ workflow.yml
â”‚   â””â”€â”€ prompts/
â”œâ”€â”€ AgentGenerator/
â”‚   â”œâ”€â”€ workflow.yml
â”‚   â””â”€â”€ templates/       â† Agent templates
â”œâ”€â”€ AppGenerator/
â”‚   â”œâ”€â”€ workflow.yml
â”‚   â””â”€â”€ templates/       â† App code templates
â””â”€â”€ ValidationEngine/
    â”œâ”€â”€ workflow.yml
    â””â”€â”€ prompts/

NOTE: This repo contains ONLY workflow definitions, NOT the runtime.
The runtime engine lives in public mozaiks-ai repo.
```

**What You'll Gut Before Open-Sourcing:**
- âœ‚ï¸ Remove all your proprietary workflows from `workflows/` folder
- âœ‚ï¸ Remove any hardcoded references to your specific workflows
- âœ‚ï¸ Keep the runtime engine, ChatUI, and plugin system
- âœ… Add simple example workflows (hello-world, basic automation)

**Your Production Deployment:**
```bash
# Start the public runtime with your private workflow definitions
docker run mozaiks/mozaiks-ai \
  --workflow-plugins /path/to/mozaiks-workflows  â† Mount workflow definitions
  --env WORKFLOWS_ENABLED=ValueEngine,DesignDocument,AgentGenerator,AppGenerator,ValidationEngine
```

**What this means:**
- The **runtime engine** (execution, ChatUI, plugin loader) is in `mozaiks-ai` (public)
- Your **workflow definitions** (logic, prompts, templates) are in `mozaiks-workflows` (private)
- At startup, the public runtime loads your private workflow definitions as plugins

**Think of it like:**
- **Kubernetes** = runtime (public) + **Your YAML configs** = definitions (private)
- **Temporal.io** = runtime (public) + **Your workflow code** = definitions (private)
- **MozaiksAI** = runtime (public) + **Your workflows** = definitions (private)

**Community Users Can:**
- Use the open-source runtime with their own workflows
- Create custom workflows as plugins
- Share community workflows
- Never see your proprietary 5 workflows

---

## WHO MANAGES WHAT: The Complete Matrix

### Repos YOU Manage (As Mozaiks Platform Owner)

| Repo Name | Public/Private | What It Contains | Who Uses It | Where It Runs |
|-----------|----------------|------------------|-------------|---------------|
| **mozaiks-backend** | ğŸ”’ Private | .NET microservices (Auth, Payment, Governance, ValidationEngine, Hosting, etc.) | You + all users (via API) | Your Azure |
| **mozaiks-frontend** | ğŸ”’ Private | React UI + ChatWidget integration | You (platform UI) | Your Azure |
| **mozaiks-ai** | ğŸŒ Public (open-source) | Workflow runtime engine + ChatUI components + plugin loader | You + all users | Your Azure (managed) OR user's infra (self-hosted) |
| **mozaiks-workflows** | ğŸ”’ Private | Workflow definitions ONLY (ValueEngine, DesignDocument, AgentGenerator, AppGenerator, ValidationEngine) â€” NO runtime code | You only | Loaded into mozaiks-ai runtime |
| **mozaiks-core** | ğŸŒ Public (open-source) | App runtime SDK (auth, payments, hosting services) | Users' generated apps | User's infra OR your Azure |

**Key Point:** You manage 5 repos total. 2 are public (runtimes), 3 are private (your IP).

---

### Repos USERS Manage (Generated Apps)

| Repo Name | Public/Private | What It Contains | Created By | Where It Runs |
|-----------|----------------|------------------|------------|---------------|
| **user123/my-app** | ğŸ”’ Private (user's) | Generated app code (frontend, backend, workflows, agents) | AppGenerator workflow â†’ mozaiks-backend creates repo | User's infra OR your Azure |

**Key Point:** Each user gets 1 repo per app. They own it, modify it, deploy it.

---

## The App Generation Flow (Who Does What)

### Step-by-Step: What Happens When User Clicks "Deploy"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: User Builds App via ChatUI                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User: "Build me a task tracker with React and Python"
  â”‚
  â–¼
MOZ-UI (mozaiks-frontend)
  â”‚
  â–¼
ChatUI sends message to MozaiksAI Runtime (mozaiks-ai)
  â”‚
  â–¼
MozaiksAI Runtime loads AppGenerator workflow
  â”‚
  â”‚ WHERE DOES AppGenerator COME FROM?
  â”‚ â†’ It's in mozaiks-workflows repo (private)
  â”‚ â†’ Loaded as plugin into mozaiks-ai runtime at startup
  â”‚
  â–¼
AppGenerator workflow executes:
  â”œâ”€ Generates React frontend code
  â”œâ”€ Generates Python backend code
  â”œâ”€ Generates workflow definitions (.yml files)
  â”œâ”€ Generates agent definitions (.json files)
  â”œâ”€ Generates docker-compose.yml
  â””â”€ Generates README.md
  â”‚
  â–¼
Generated code is returned to MozaiksAI Runtime
  â”‚
  â–¼
MozaiksAI Runtime sends generated code to mozaiks-backend
  â”‚
  â–¼
mozaiks-backend stores generated code temporarily
(In-memory cache or temp storage, NOT committed yet)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: User Clicks "Deploy" or "Export"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks "Deploy" in MOZ-UI
  â”‚
  â–¼
MOZ-UI calls mozaiks-backend API:
  POST /api/hosting/deploy
  {
    "sessionId": "abc123",  â† Links to stored generated code
    "deploymentMode": "github-repo" | "zip" | "azure-hosting"
  }
  â”‚
  â–¼
mozaiks-backend (Hosting.API) handles deployment:
  â”‚
  â”œâ”€ Mode: "zip"
  â”‚   â””â”€ Zips generated code, returns download link
  â”‚
  â”œâ”€ Mode: "github-repo"
  â”‚   â”œâ”€ Calls GitHub API with user's OAuth token
  â”‚   â”œâ”€ Creates repo: github.com/user123/my-app
  â”‚   â”œâ”€ Commits all generated code
  â”‚   â””â”€ Returns repo URL
  â”‚
  â””â”€ Mode: "azure-hosting"
      â”œâ”€ Deploys to user's Azure OR Mozaiks-managed Azure
      â”œâ”€ Creates container instances
      â””â”€ Returns live app URL


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: User's Repo Structure (What Gets Committed)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

github.com/user123/my-app/
â”œâ”€â”€ frontend/                      â† Generated by AppGenerator
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ pages/
â”‚   â”œâ”€â”€ package.json               â† Includes @mozaiks/core-runtime
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ backend/                       â† Generated by AppGenerator
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ requirements.txt           â† Includes mozaiks-core-runtime
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ workflows/                     â† Generated by AppGenerator
â”‚   â”œâ”€â”€ onboarding.yml             â† User's custom workflow
â”‚   â””â”€â”€ notifications.yml          â† User's custom workflow
â”‚
â”œâ”€â”€ agents/                        â† Generated by AgentGenerator
â”‚   â”œâ”€â”€ support-bot.json           â† User's custom agent
â”‚   â””â”€â”€ analytics-agent.json       â† User's custom agent
â”‚
â”œâ”€â”€ .env.example                   â† Generated config template
â”œâ”€â”€ docker-compose.yml             â† Includes MozaiksCore runtime
â”œâ”€â”€ README.md                      â† Generated setup instructions
â””â”€â”€ .gitignore                     â† Standard ignores
```

---

## How mozaiks-workflows Connects to mozaiks-ai Runtime

### The Critical Distinction

**mozaiks-workflows does NOT connect to mozaiks-ai at runtime via WebSocket/HTTP.**  
**It's loaded as a PLUGIN at STARTUP.**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STARTUP: Loading Workflow Definitions                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

When you deploy mozaiks-ai runtime:

docker run mozaiks/mozaiks-ai \
  --mount type=bind,source=/path/to/mozaiks-workflows,target=/app/workflows  â† File system mount
  --env WORKFLOWS_ENABLED=ValueEngine,DesignDocument,AgentGenerator,AppGenerator,ValidationEngine

OR (Kubernetes):

apiVersion: v1
kind: Pod
spec:
  containers:
  - name: mozaiks-ai
    image: mozaiks/mozaiks-ai
    volumeMounts:
    - name: workflows
      mountPath: /app/workflows       â† Mount mozaiks-workflows repo
  volumes:
  - name: workflows
    secret:
      secretName: mozaiks-workflows   â† Private workflow definitions

At startup, mozaiks-ai runtime:
  1. Scans /app/workflows directory
  2. Discovers: ValueEngine/, DesignDocument/, AgentGenerator/, etc.
  3. Loads workflow.yml files
  4. Registers workflows in the runtime engine
  5. Now ready to execute when user sends messages
```

### How mozaiks-frontend Connects to mozaiks-ai

**THIS is where WebSocket comes in:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RUNTIME: User Interaction via WebSocket                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User types message in ChatUI (in MOZ-UI)
        â”‚
        â”‚ WebSocket connection
        â–¼
mozaiks-ai runtime (already has workflows loaded)
        â”‚
        â”‚ Executes appropriate workflow (ValueEngine, AppGenerator, etc.)
        â”‚
        â–¼
Streams response back to ChatUI
        â”‚
        â”‚ WebSocket streaming
        â–¼
User sees response in real-time
```

**WebSocket endpoint:**
```javascript
// In mozaiks-frontend (MOZ-UI)
const ws = new WebSocket('wss://mozaiks-ai.example.com/api/chat');

ws.send(JSON.stringify({
  message: "Build me a task tracker",
  sessionId: "abc123",
  userId: "user456"
}));

ws.onmessage = (event) => {
  // Receive streaming response from workflow execution
  const data = JSON.parse(event.data);
  console.log(data.chunk); // "Generating frontend..."
};
```

---

## The Complete Connection Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3 DISTINCT CONNECTION TYPES                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CONNECTION 1: mozaiks-workflows â†’ mozaiks-ai
  â”œâ”€ Type: File system mount (Docker volume or Kubernetes secret)
  â”œâ”€ When: At startup (before runtime accepts traffic)
  â”œâ”€ How: /app/workflows directory mounted from mozaiks-workflows repo
  â””â”€ Protocol: File I/O (read YAML files, load into memory)

CONNECTION 2: mozaiks-frontend â†’ mozaiks-ai
  â”œâ”€ Type: WebSocket (real-time bidirectional)
  â”œâ”€ When: User sends chat messages
  â”œâ”€ How: wss://mozaiks-ai.example.com/api/chat
  â””â”€ Protocol: WebSocket (streaming responses)

CONNECTION 3: mozaiks-ai â†’ mozaiks-backend
  â”œâ”€ Type: HTTP REST API
  â”œâ”€ When: Workflow completes, needs to store generated code
  â”œâ”€ How: POST https://api.mozaiks.com/hosting/store-generated-code
  â””â”€ Protocol: HTTP/REST
```

---

## The Collaboration: Which Services Work Together?

### During App Generation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WHO DOES WHAT                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  1. mozaiks-frontend (MOZ-UI)                                â”‚
â”‚     â”œâ”€ Provides ChatUI interface                            â”‚
â”‚     â””â”€ Connects to mozaiks-ai via WebSocket                 â”‚
â”‚                                                               â”‚
â”‚  2. mozaiks-ai (Runtime Engine)                              â”‚
â”‚     â”œâ”€ Loads workflows from mozaiks-workflows at startup    â”‚
â”‚     â”œâ”€ Receives user messages via WebSocket                 â”‚
â”‚     â”œâ”€ Executes workflow engine                             â”‚
â”‚     â””â”€ Returns generated code via HTTP to mozaiks-backend   â”‚
â”‚                                                               â”‚
â”‚  3. mozaiks-workflows (Workflow Definitions)                 â”‚
â”‚     â”œâ”€ Mounted as volume in mozaiks-ai container            â”‚
â”‚     â”œâ”€ AppGenerator workflow logic                          â”‚
â”‚     â”œâ”€ Code generation templates                            â”‚
â”‚     â””â”€ Prompts for AI models                                â”‚
â”‚                                                               â”‚
â”‚  4. mozaiks-backend (Control Plane)                          â”‚
â”‚     â”œâ”€ Receives generated code from mozaiks-ai via HTTP     â”‚
â”‚     â”œâ”€ Stores code temporarily                              â”‚
â”‚     â”œâ”€ Creates GitHub repos via API                         â”‚
â”‚     â”œâ”€ Deploys to Azure (if managed hosting)                â”‚
â”‚     â””â”€ Manages user subscriptions/permissions               â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Collaboration Pattern (Step-by-Step)

```
STEP 1: Startup (Before Any User Traffic)
  mozaiks-ai container starts
        â”‚
        â”‚ File system mount
        â–¼
  Loads workflows from /app/workflows
  (Mounted from mozaiks-workflows repo)
        â”‚
        â–¼
  mozaiks-ai runtime is ready

STEP 2: User Interaction
  User types in MOZ-UI ChatWidget
        â”‚
        â”‚ WebSocket (wss://)
        â–¼
  mozaiks-ai receives message
        â”‚
        â”‚ In-memory execution (workflows already loaded)
        â–¼
  Executes AppGenerator workflow
        â”‚
        â”‚ WebSocket streaming
        â–¼
  User sees progress: "Generating frontend..."

STEP 3: Code Storage
  AppGenerator workflow completes
        â”‚
        â”‚ HTTP POST
        â–¼
  mozaiks-backend receives generated code
        â”‚
        â–¼
  Stores temporarily

STEP 4: Deployment
  User clicks "Deploy" in MOZ-UI
        â”‚
        â”‚ HTTP POST
        â–¼
  mozaiks-backend creates GitHub repo
        â”‚
        â–¼
  user123/my-app is created
```

---

## The Answer to Your Specific Questions

### Q1: "What repos do I (Mozaiks owner) manage?"

**5 repos total:**

1. **mozaiks-backend** (ğŸ”’ Private)
   - Your .NET microservices
   - You deploy this
   - You maintain this

2. **mozaiks-frontend** (ğŸ”’ Private)
   - Your React UI
   - You deploy this
   - You maintain this

3. **mozaiks-ai** (ğŸŒ Public)
   - Workflow runtime engine (open-source)
   - You deploy the managed version
   - Community can contribute

4. **mozaiks-workflows** (ğŸ”’ Private)
   - Your 5 proprietary workflows
   - You maintain this
   - Never open-sourced

5. **mozaiks-core** (ğŸŒ Public)
   - App runtime SDK (open-source)
   - Published to npm/pypi
   - Community can contribute

---

### Q2: "What repos do users manage?"

**1 repo per app they create:**

- **user123/my-app** (user's private repo)
  - Created by your backend when they click "Deploy"
  - Contains all generated code
  - User owns it, modifies it, deploys it

**User does NOT manage:**
- âŒ mozaiks-ai (they use your hosted version OR self-host it)
- âŒ mozaiks-core (they install it as a dependency)
- âŒ mozaiks-backend (they call your APIs)

---

### Q3: "What goes into the user's repo during creation?"

**Everything needed to run their app:**

```
user123/my-app/
â”œâ”€â”€ frontend/              â† Full React app (generated)
â”œâ”€â”€ backend/               â† Full Python API (generated)
â”œâ”€â”€ workflows/             â† Workflow definitions (generated)
â”œâ”€â”€ agents/                â† Agent definitions (generated)
â”œâ”€â”€ docker-compose.yml     â† Deployment config (generated)
â”œâ”€â”€ .env.example           â† Config template (generated)
â”œâ”€â”€ README.md              â† Setup instructions (generated)
â””â”€â”€ .github/workflows/     â† Optional CI/CD (generated)
```

**Dependencies included:**
- `package.json` â†’ `"@mozaiks/core-runtime": "^1.0.0"`
- `requirements.txt` â†’ `mozaiks-core-runtime==1.0.0`

**NOT included:**
- âŒ MozaiksAI runtime engine code (they connect to it)
- âŒ Your proprietary workflows (only their custom workflows)
- âŒ Mozaiks backend services (they call via API)

---

### Q4: "How does the PR/creation work? Collaboration between mozaiks-backend and mozaiks-workflows?"

**YES - It's a collaboration:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  The Handshake                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  User: "Build me an app"                                    â”‚
â”‚    â”‚                                                         â”‚
â”‚    â–¼                                                         â”‚
â”‚  mozaiks-frontend (ChatUI)                                  â”‚
â”‚    â”‚                                                         â”‚
â”‚    â–¼                                                         â”‚
â”‚  mozaiks-ai (runtime engine)                                â”‚
â”‚    â”‚                                                         â”‚
â”‚    â”‚ "I need the AppGenerator workflow"                     â”‚
â”‚    â–¼                                                         â”‚
â”‚  mozaiks-workflows/AppGenerator/                            â”‚
â”‚    â”œâ”€ workflow.yml        â† Workflow logic                  â”‚
â”‚    â”œâ”€ prompts/            â† AI prompts                      â”‚
â”‚    â””â”€ templates/          â† Code templates                  â”‚
â”‚    â”‚                                                         â”‚
â”‚    â”‚ AppGenerator executes, produces:                       â”‚
â”‚    â”‚ - frontend.zip                                          â”‚
â”‚    â”‚ - backend.zip                                           â”‚
â”‚    â”‚ - workflows.zip                                         â”‚
â”‚    â”‚ - metadata.json                                         â”‚
â”‚    â–¼                                                         â”‚
â”‚  mozaiks-ai (runtime engine)                                â”‚
â”‚    â”‚                                                         â”‚
â”‚    â”‚ Sends generated code to:                               â”‚
â”‚    â–¼                                                         â”‚
â”‚  mozaiks-backend (Hosting.API)                              â”‚
â”‚    â”‚                                                         â”‚
â”‚    â”‚ Stores code temporarily                                â”‚
â”‚    â”‚ User clicks "Deploy"                                   â”‚
â”‚    â–¼                                                         â”‚
â”‚  GitHub API                                                  â”‚
â”‚    â”‚                                                         â”‚
â”‚    â”‚ Creates repo: user123/my-app                           â”‚
â”‚    â”‚ Commits all generated code                             â”‚
â”‚    â–¼                                                         â”‚
â”‚  user123/my-app (new repo created)                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Q5: "Did we decide on separate mozaiks-workflows or mozaiks-ai-proprietary with runtime?"

**WE DECIDED ON: SEPARATE REPOS**

```
âœ… FINAL ARCHITECTURE (Confirmed):

1. mozaiks-ai (PUBLIC)
   â”œâ”€â”€ Runtime engine ONLY
   â”œâ”€â”€ ChatUI components
   â”œâ”€â”€ Plugin loader
   â””â”€â”€ workflows/ â† EMPTY

2. mozaiks-workflows (PRIVATE)
   â”œâ”€â”€ ValueEngine/workflow.yml
   â”œâ”€â”€ DesignDocument/workflow.yml
   â”œâ”€â”€ AgentGenerator/workflow.yml
   â”œâ”€â”€ AppGenerator/workflow.yml
   â””â”€â”€ ValidationEngine/workflow.yml
   
   NO RUNTIME CODE - Just definitions

3. At startup:
   mozaiks-ai runtime loads mozaiks-workflows as plugins
```

**WHY separate?**
- âœ… Keep runtime open-source
- âœ… Keep workflows proprietary
- âœ… Community can use runtime with their own workflows
- âœ… You can update workflows without touching runtime

**NOT this approach:**
```
âŒ mozaiks-ai-proprietary (Private repo with runtime + workflows)
   â””â”€ This would mean closed-source runtime
   â””â”€ Community couldn't use it
```

---

## Summary: Repo Ownership Matrix

| Repo | Owner | Public/Private | Contains | Deployed By |
|------|-------|----------------|----------|-------------|
| **mozaiks-backend** | You | ğŸ”’ Private | .NET services | You |
| **mozaiks-frontend** | You | ğŸ”’ Private | React UI | You |
| **mozaiks-ai** | You (+ community) | ğŸŒ Public | Runtime engine | You (managed) OR users (self-hosted) |
| **mozaiks-workflows** | You | ğŸ”’ Private | Workflow definitions | Loaded by mozaiks-ai |
| **mozaiks-core** | You (+ community) | ğŸŒ Public | App runtime SDK | Installed via npm/pip |
| **user123/my-app** | User | ğŸ”’ Private | Generated app | User (or you if managed hosting) |

**Your Management Load:**
- 3 private repos (backend, frontend, workflows)
- 2 public repos (ai runtime, core runtime)

**User's Management Load:**
- 1 repo per app (their generated code)

---

## Questions This Answers

âœ… "Where do repos live?" â†’ User's GitHub or local machine  
âœ… "Is MozaiksAI open-source?" â†’ Yes, runtime is public, workflows can be private  
âœ… "Is MozaiksCore open-source?" â†’ Yes, it's the app runtime  
âœ… "Are generated apps standalone?" â†’ No, they need both runtimes  
âœ… "What repos will I have?" â†’ 5 platform repos (3 private, 2 public) + N user repos  
âœ… "Do I use MozaiksCore for Mozaiks platform?" â†’ No, only users' generated apps use it  
âœ… "Fork or copy?" â†’ Neither â€” runtimes are services, workflows are plugins
âœ… "Who manages what?" â†’ You manage 5 repos, users manage 1 per app
âœ… "What's in user's repo?" â†’ All generated code (frontend, backend, workflows, agents)
âœ… "How does generation work?" â†’ mozaiks-ai (runtime) + mozaiks-workflows (definitions) â†’ mozaiks-backend (deployment)
âœ… "Separate workflows repo?" â†’ YES - mozaiks-workflows is separate from mozaiks-ai runtime

---

## Your Final Repo Count (Summary)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PLATFORM REPOS (What You Maintain)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. mozaiks-backend (formerly BlocUnitedMicroservice)
   - Private repo
   - .NET microservices
   - Auth, Payment, Governance, ValidationEngine, Hosting, etc.
   - YOU use this

2. mozaiks-frontend (formerly MOZ-UI)
   - Private repo
   - React/Next.js
   - Includes ChatWidget integration from mozaiks-ai
   - YOU use this

3. mozaiks-ai (formerly MozaiksAI)
   - Public repo (open-source runtime)
   - Workflow execution engine
   - ChatUI/ChatWidget components
   - **workflows/ folder is EMPTY** (workflow-agnostic)
   - Example workflows only (hello-world)
   - YOU use this + YOUR USERS use this

4. mozaiks-core (formerly MozaiksCore)
   - Public repo (open-source runtime)
   - App runtime system
   - Auth/payment/hosting SDKs
   - YOU don't use this (users' generated apps use it)

5. mozaiks-workflows (PRIVATE repo - your IP)
   - Private repo (your secret sauce)
   - **Workflow DEFINITIONS only** (not the runtime)
   - ValueEngine, DesignDocument, AgentGenerator, AppGenerator, ValidationEngine
   - Just .yml files, prompts, templates, tool configs
   - Loaded as plugins into mozaiks-ai runtime at startup
   - **Never gets open-sourced**
   - YOU use this

**Separation:**
```
mozaiks-ai/              â† PUBLIC (runtime engine)
â”œâ”€â”€ src/runtime/         â† Workflow execution engine
â”œâ”€â”€ src/chatui/          â† Chat UI components
â””â”€â”€ workflows/           â† EMPTY

mozaiks-workflows/       â† PRIVATE (workflow definitions)
â”œâ”€â”€ ValueEngine/workflow.yml
â”œâ”€â”€ DesignDocument/workflow.yml
â”œâ”€â”€ AgentGenerator/workflow.yml
â”œâ”€â”€ AppGenerator/workflow.yml
â””â”€â”€ ValidationEngine/workflow.yml
```


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER REPOS (Created On-Demand)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

user1/app1, user2/app2, user3/app3, ...
   - Created by your platform when user clicks "Deploy"
   - Contains generated app code + workflow definitions
   - Runs on mozaiks-core runtime
   - Workflows execute on mozaiks-ai runtime
```

---

**Bottom Line:** 
- **You'll have 4-5 repos** for the Mozaiks platform itself
- **Users get 1 repo each** for their generated apps
- **MozaiksAI runtime** executes your 5 workflows + users' custom workflows
- **MozaiksCore runtime** executes users' generated app code (you don't use it for Mozaiks platform)
- **Your 5 workflows are your secret sauce** â€” keep them private as plugins

---

## Testing Strategy: Keeping Workflows Private While Runtime is Open

### The Challenge

You need to:
- âœ… Test AppGenerator workflow with MozaiksAI runtime
- âœ… Keep MozaiksAI runtime open-source
- âœ… Keep AppGenerator workflow private
- âœ… Allow community to test runtime with their own workflows

### The Solution: Separate Test Suites

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PUBLIC REPO: mozaiks-ai (Open-Source)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  tests/                                                         â”‚
â”‚  â”œâ”€â”€ runtime/                   â† Test runtime engine itself   â”‚
â”‚  â”‚   â”œâ”€â”€ test_workflow_loader.py                               â”‚
â”‚  â”‚   â”œâ”€â”€ test_step_execution.py                                â”‚
â”‚  â”‚   â””â”€â”€ test_plugin_system.py                                 â”‚
â”‚  â”‚                                                              â”‚
â”‚  â”œâ”€â”€ integration/               â† Test with example workflows  â”‚
â”‚  â”‚   â”œâ”€â”€ test_hello_world.py                                   â”‚
â”‚  â”‚   â””â”€â”€ test_basic_automation.py                              â”‚
â”‚  â”‚                                                              â”‚
â”‚  â””â”€â”€ fixtures/                  â† Example workflows for tests  â”‚
â”‚      â”œâ”€â”€ hello-world/                                           â”‚
â”‚      â”‚   â””â”€â”€ workflow.yml                                       â”‚
â”‚      â””â”€â”€ basic-automation/                                      â”‚
â”‚          â””â”€â”€ workflow.yml                                       â”‚
â”‚                                                                 â”‚
â”‚  CI/CD: GitHub Actions                                          â”‚
â”‚  - Runs tests with example workflows only                      â”‚
â”‚  - Community can contribute tests                              â”‚
â”‚  - No proprietary workflows in CI                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PRIVATE REPO: mozaiks-workflows (Your IP)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ValueEngine/                                                   â”‚
â”‚  DesignDocument/                                                â”‚
â”‚  AgentGenerator/                                                â”‚
â”‚  AppGenerator/                                                  â”‚
â”‚  ValidationEngine/                                              â”‚
â”‚                                                                 â”‚
â”‚  tests/                         â† Test YOUR workflows          â”‚
â”‚  â”œâ”€â”€ test_value_engine.py                                      â”‚
â”‚  â”œâ”€â”€ test_app_generator.py     â† Test AppGenerator here!       â”‚
â”‚  â””â”€â”€ test_validation_engine.py                                 â”‚
â”‚                                                                 â”‚
â”‚  CI/CD: Private GitHub Actions                                  â”‚
â”‚  - Pulls mozaiks-ai runtime image from Docker Hub              â”‚
â”‚  - Mounts your workflows as volume                             â”‚
â”‚  - Runs integration tests                                      â”‚
â”‚  - Results stay private                                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Local Development Setup

### Your Development Environment

```bash
# Your workspace structure
~/projects/
â”œâ”€â”€ mozaiks-ai/              â† Public runtime (git clone from GitHub)
â”‚   â”œâ”€â”€ src/runtime/
â”‚   â”œâ”€â”€ tests/               â† Runtime tests only
â”‚   â””â”€â”€ docker-compose.yml
â”‚
â””â”€â”€ mozaiks-workflows/       â† Private workflows (your repo)
    â”œâ”€â”€ AppGenerator/
    â”œâ”€â”€ tests/               â† Workflow integration tests
    â””â”€â”€ docker-compose.dev.yml
```

### Running Tests Locally

**Option 1: Mount Private Workflows into Public Runtime**

```bash
# In ~/projects/mozaiks-workflows/

# docker-compose.dev.yml
version: '3.8'
services:
  mozaiks-ai:
    image: mozaiks/mozaiks-ai:latest  # â† Public image
    volumes:
      - ./:/app/workflows  # â† Mount YOUR private workflows
    environment:
      - WORKFLOWS_PATH=/app/workflows
      - WORKFLOWS_ENABLED=AppGenerator,ValueEngine,DesignDocument,AgentGenerator,ValidationEngine
    ports:
      - "8080:8080"

# Start runtime with your workflows
docker-compose -f docker-compose.dev.yml up

# Run your private workflow tests
pytest tests/test_app_generator.py
```

**Option 2: Local Development Mode (No Docker)**

```bash
# In ~/projects/mozaiks-ai/ (public repo)
# Install runtime in editable mode
pip install -e .

# In ~/projects/mozaiks-workflows/ (private repo)
# Run tests that point to your workflows
export MOZAIKS_WORKFLOWS_PATH=~/projects/mozaiks-workflows
pytest tests/test_app_generator.py

# The test will:
# 1. Import mozaiks-ai runtime (from your local install)
# 2. Load workflows from MOZAIKS_WORKFLOWS_PATH
# 3. Execute AppGenerator
# 4. Verify output
```

---

## CI/CD Testing Strategy

### Public Repo CI (mozaiks-ai)

**`.github/workflows/test.yml` (in mozaiks-ai repo):**

```yaml
name: Test MozaiksAI Runtime

on: [push, pull_request]

jobs:
  test-runtime:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install -e .
          pip install pytest
      
      - name: Test runtime engine
        run: pytest tests/runtime/
        # Tests workflow loader, execution engine, plugin system
        # Does NOT test your proprietary workflows
      
      - name: Test with example workflows
        run: pytest tests/integration/
        # Tests with hello-world and basic-automation examples
        # Proves runtime works with community workflows

  test-docker:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Build Docker image
        run: docker build -t mozaiks-ai:test .
      
      - name: Test with mounted example workflows
        run: |
          docker run -v $(pwd)/tests/fixtures:/app/workflows \
            mozaiks-ai:test pytest tests/integration/
```

**Key point:** Public CI never sees your proprietary workflows.

---

### Private Repo CI (mozaiks-workflows)

**`.github/workflows/test-workflows.yml` (in mozaiks-workflows repo):**

```yaml
name: Test Proprietary Workflows

on: [push, pull_request]

jobs:
  test-with-runtime:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          path: workflows  # Check out YOUR workflows
      
      - name: Pull public runtime image
        run: docker pull mozaiks/mozaiks-ai:latest
      
      - name: Start runtime with YOUR workflows
        run: |
          docker run -d \
            --name mozaiks-ai-test \
            -v $(pwd)/workflows:/app/workflows \
            -e WORKFLOWS_ENABLED=AppGenerator,ValueEngine \
            -p 8080:8080 \
            mozaiks/mozaiks-ai:latest
      
      - name: Wait for runtime to be ready
        run: |
          timeout 30 bash -c 'until curl -f http://localhost:8080/health; do sleep 1; done'
      
      - name: Run workflow integration tests
        run: |
          cd workflows
          pip install pytest requests
          pytest tests/test_app_generator.py
      
      - name: Cleanup
        run: docker stop mozaiks-ai-test
```

**Key point:** Private CI pulls public runtime, tests your workflows, results stay private.

---

## Test Examples

### Public Runtime Test (mozaiks-ai/tests/runtime/)

```python
# mozaiks-ai/tests/runtime/test_workflow_loader.py
import pytest
from mozaiks_ai.runtime import WorkflowLoader

def test_workflow_loader_discovers_workflows():
    """Test that runtime can discover workflows in a directory."""
    loader = WorkflowLoader(path="tests/fixtures")
    workflows = loader.discover()
    
    assert "hello-world" in workflows
    assert "basic-automation" in workflows

def test_workflow_loader_validates_yaml():
    """Test that runtime validates workflow.yml schema."""
    loader = WorkflowLoader(path="tests/fixtures/hello-world")
    workflow = loader.load("hello-world")
    
    assert workflow.name == "Hello World"
    assert len(workflow.steps) > 0
```

**This tests the runtime itself, not your workflows.**

---

### Private Workflow Test (mozaiks-workflows/tests/)

```python
# mozaiks-workflows/tests/test_app_generator.py
import pytest
import requests
from pathlib import Path

@pytest.fixture
def runtime_url():
    """Assumes mozaiks-ai runtime is running at localhost:8080."""
    return "http://localhost:8080"

def test_app_generator_creates_react_app(runtime_url):
    """Test that AppGenerator workflow generates valid React code."""
    
    # Send message to runtime (via WebSocket or HTTP)
    response = requests.post(f"{runtime_url}/api/workflows/execute", json={
        "workflow": "AppGenerator",
        "input": {
            "message": "Build a task tracker with React and Python",
            "user_id": "test-user"
        }
    })
    
    assert response.status_code == 200
    result = response.json()
    
    # Verify generated code structure
    assert "frontend" in result["generated_files"]
    assert "backend" in result["generated_files"]
    
    # Verify React app structure
    frontend = result["generated_files"]["frontend"]
    assert "package.json" in frontend
    assert "src/App.tsx" in frontend
    
    # Verify package.json includes MozaiksCore
    import json
    pkg = json.loads(frontend["package.json"])
    assert "@mozaiks/core-runtime" in pkg["dependencies"]

def test_app_generator_handles_invalid_request(runtime_url):
    """Test that AppGenerator gracefully handles invalid input."""
    
    response = requests.post(f"{runtime_url}/api/workflows/execute", json={
        "workflow": "AppGenerator",
        "input": {"message": ""}  # Empty message
    })
    
    assert response.status_code == 400
    assert "error" in response.json()
```

**This tests YOUR workflow against the public runtime.**

---

## The Development Workflow

### Day-to-Day: Working on AppGenerator

```bash
# 1. Make changes to AppGenerator workflow
cd ~/projects/mozaiks-workflows/AppGenerator
vim workflow.yml  # Edit your workflow

# 2. Test locally with runtime
cd ~/projects/mozaiks-workflows
docker-compose -f docker-compose.dev.yml up -d

# 3. Run your tests
pytest tests/test_app_generator.py -v

# 4. Commit changes (private repo)
git add AppGenerator/
git commit -m "Improve React code generation"
git push origin main

# 5. Private CI runs automatically
# - Pulls latest mozaiks-ai runtime
# - Tests your updated workflow
# - Results stay private
```

### Day-to-Day: Working on Runtime Engine

```bash
# 1. Make changes to runtime
cd ~/projects/mozaiks-ai
vim src/runtime/executor.py  # Edit runtime code

# 2. Test runtime with example workflows
pytest tests/runtime/ -v

# 3. Test with community workflows
pytest tests/integration/ -v

# 4. Commit changes (public repo)
git add src/
git commit -m "Improve workflow execution performance"
git push origin main

# 5. Public CI runs automatically
# - Tests runtime with example workflows
# - Community can see all tests
# - No proprietary workflows exposed

# 6. Go back to private repo to test YOUR workflows
cd ~/projects/mozaiks-workflows
docker pull mozaiks/mozaiks-ai:latest  # Get your latest runtime
pytest tests/ -v  # Test your workflows work with new runtime
```

---

## Integration Testing Between Repos

### Automated: Test Workflow Changes Against Latest Runtime

**In mozaiks-workflows CI:**

```yaml
# .github/workflows/test-with-runtime-versions.yml
jobs:
  test-with-latest-runtime:
    strategy:
      matrix:
        runtime-version: [latest, v1.2.0, v1.1.0]  # Test multiple versions
    
    steps:
      - name: Pull runtime version
        run: docker pull mozaiks/mozaiks-ai:${{ matrix.runtime-version }}
      
      - name: Test workflows
        run: |
          docker run -v $(pwd):/app/workflows \
            mozaiks/mozaiks-ai:${{ matrix.runtime-version }} \
            pytest tests/
```

**This ensures your workflows work with:**
- Latest runtime (bleeding edge)
- Stable versions (backward compatibility)

---

### Manual: Test Runtime Changes Against Your Workflows

```bash
# In mozaiks-ai (public repo)
# Before releasing new runtime version, test with your workflows

# 1. Build updated runtime image
cd ~/projects/mozaiks-ai
docker build -t mozaiks-ai:dev .

# 2. Test with your private workflows
cd ~/projects/mozaiks-workflows
docker run -v $(pwd):/app/workflows mozaiks-ai:dev pytest tests/

# 3. If tests pass, release new runtime version
cd ~/projects/mozaiks-ai
git tag v1.3.0
docker tag mozaiks-ai:dev mozaiks/mozaiks-ai:v1.3.0
docker push mozaiks/mozaiks-ai:v1.3.0
```

---

## Community Testing (Public)

### Community Contributors Test Runtime

```bash
# Community member wants to contribute to mozaiks-ai
git clone https://github.com/mozaiks/mozaiks-ai.git
cd mozaiks-ai

# Run public tests (no access to your workflows)
pytest tests/

# They can test with their own workflows
mkdir my-workflow
cat > my-workflow/workflow.yml <<EOF
name: My Test Workflow
steps:
  - echo: "Hello from community!"
EOF

# Mount their workflow and test
docker build -t mozaiks-ai:local .
docker run -v $(pwd)/my-workflow:/app/workflows mozaiks-ai:local
```

**Key point:** Community never sees your proprietary workflows, but can fully test the runtime.

---

## Summary: Testing Strategy

| What to Test | Where | How | Visibility |
|--------------|-------|-----|------------|
| **Runtime engine** | mozaiks-ai repo | Unit tests with example workflows | Public (open-source) |
| **YOUR workflows** | mozaiks-workflows repo | Integration tests against runtime | Private (your CI only) |
| **Runtime + Workflows** | Local dev | Mount workflows into runtime container | Local only |
| **Community workflows** | mozaiks-ai repo | Contributors test with their workflows | Public (open-source) |

**The separation works because:**
- âœ… Public runtime is fully testable without your workflows
- âœ… Your workflows are testable against public runtime
- âœ… CI/CD pipelines are separate (public vs private)
- âœ… Community can contribute without seeing your IP

---

## Deployment Architecture: How It All Connects

### Your Production Deployment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AZURE CONTAINER APPS (Your Infrastructure)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Container 1: mozaiks-ai (Runtime)
  â”œâ”€ Image: mozaiks/mozaiks-ai:latest
  â”œâ”€ Port: 8080 (WebSocket endpoint)
  â”œâ”€ Volume Mount: Azure Files â†’ /app/workflows
  â”‚   â””â”€ Contains: mozaiks-workflows repo (your 5 proprietary workflows)
  â””â”€ Environment:
      â”œâ”€ WORKFLOWS_PATH=/app/workflows
      â”œâ”€ WORKFLOWS_ENABLED=ValueEngine,DesignDocument,AgentGenerator,AppGenerator,ValidationEngine
      â””â”€ BACKEND_API_URL=https://api.mozaiks.com

Container 2: mozaiks-backend (Control Plane)
  â”œâ”€ Image: mozaiks/backend:latest
  â”œâ”€ Port: 8010 (Ocelot gateway)
  â””â”€ Environment:
      â”œâ”€ MONGODB_CONNECTION=...
      â”œâ”€ RABBITMQ_CONNECTION=...
      â””â”€ MOZAIKSAI_URL=https://mozaiks-ai.example.com

Container 3: mozaiks-frontend (UI)
  â”œâ”€ Image: mozaiks/frontend:latest
  â”œâ”€ Port: 3000
  â””â”€ Environment:
      â”œâ”€ BACKEND_API_URL=https://api.mozaiks.com
      â””â”€ MOZAIKSAI_WS_URL=wss://mozaiks-ai.example.com/api/chat

Azure Files (Private Storage)
  â””â”€ mozaiks-workflows/
      â”œâ”€ ValueEngine/workflow.yml
      â”œâ”€ DesignDocument/workflow.yml
      â”œâ”€ AgentGenerator/workflow.yml
      â”œâ”€ AppGenerator/workflow.yml
      â””â”€ ValidationEngine/workflow.yml
```

### How Secrets Stay Secret

```
mozaiks-ai (PUBLIC IMAGE on Docker Hub)
  â”œâ”€ DOES NOT contain your workflows
  â”œâ”€ Just the runtime engine
  â””â”€ Expects workflows to be mounted at /app/workflows

At deployment time:
  1. You build mozaiks-ai image (from public repo)
  2. You deploy to Azure Container Apps
  3. You mount Azure Files volume containing mozaiks-workflows (private)
  4. Runtime loads workflows from mounted volume
  5. Your 5 workflows are NEVER in the public image

Anyone can pull mozaiks/mozaiks-ai image, but it's workflow-agnostic.
Your workflows stay in your private Azure Files storage.
```

---

### Before Open-Sourcing: Pre-Flight Checklist

**What to gut from MozaiksAI repo:**
- âœ‚ï¸ `workflows/ValueEngine/` â€” Delete
- âœ‚ï¸ `workflows/DesignDocument/` â€” Delete
- âœ‚ï¸ `workflows/AgentGenerator/` â€” Delete
- âœ‚ï¸ `workflows/AppGenerator/` â€” Delete
- âœ‚ï¸ `workflows/ValidationEngine/` â€” Delete
- âœ‚ï¸ Any hardcoded workflow imports/references
- âœ‚ï¸ Proprietary prompt templates
- âœ‚ï¸ Business logic specific to Mozaiks platform

**What to keep in MozaiksAI repo:**
- âœ… Workflow runtime engine
- âœ… ChatUI/ChatWidget components
- âœ… Plugin system for loading external workflows from /app/workflows
- âœ… Tool integration framework (API connectors)
- âœ… Simple example workflows (hello-world, basic-automation)
- âœ… Documentation for creating custom workflows

**New folder structure after gutting:**
```
mozaiks-ai/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ runtime/         â† Core workflow execution engine
â”‚   â”œâ”€â”€ chatui/          â† Chat widget
â”‚   â”œâ”€â”€ plugin-loader/   â† Loads workflows from /app/workflows at startup
â”‚   â””â”€â”€ tools/           â† Generic tool framework
â”œâ”€â”€ workflows/           â† EMPTY (just README)
â”‚   â””â”€â”€ README.md        â† "Mount your workflow definitions at /app/workflows"
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ hello-world/     â† Simple example
â”‚   â””â”€â”€ email-automation/ â† Basic example
â””â”€â”€ docs/
    â””â”€â”€ creating-workflows.md
```

---

## How MozaiksCore and MozaiksAI Runtimes Connect

### The Critical Question: When/Where/How/Who?

**MozaiksCore** (app runtime) and **MozaiksAI** (workflow runtime) are **separate processes** that communicate via APIs. Think of it like:
- **Node.js** (app runtime) + **AWS Step Functions** (workflow runtime)
- They run independently but can trigger each other

### The 3 Connection Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    1. BUILD TIME (Generation)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User â†’ MozaiksAI ChatUI
         â”‚
         â–¼
MozaiksAI Runtime executes AppGenerator workflow
         â”‚
         â”œâ”€ Generates React frontend code
         â”œâ”€ Generates Python backend code
         â”œâ”€ Generates workflow definitions (.yml)
         â””â”€ Injects MozaiksCore SDK references
         â”‚
         â–¼
Outputs stored in Mozaiks Backend (.NET)
         â”‚
         â–¼
User clicks "Deploy"
         â”‚
         â–¼
Backend creates GitHub repo with generated code
         â”‚
         â–¼
Generated app includes:
  â”œâ”€â”€ package.json â†’ "@mozaiks/core-runtime": "^1.0.0"
  â”œâ”€â”€ requirements.txt â†’ "mozaiks-core-runtime==1.0.0"
  â””â”€â”€ workflows/ â†’ User's workflow definitions


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  2. RUNTIME (App â†’ Workflow)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User interacts with their deployed app
         â”‚
         â–¼
App code (running on MozaiksCore) detects trigger:
  - User creates a task
  - Payment completes
  - Schedule fires
         â”‚
         â–¼
MozaiksCore SDK makes HTTP call to MozaiksAI Runtime:
  POST https://mozaiks-ai.example.com/api/workflows/execute
  {
    "workflow": "send-notification",
    "trigger": "task.created",
    "data": { "taskId": "123", "userId": "user456" }
  }
         â”‚
         â–¼
MozaiksAI Runtime executes the workflow
         â”‚
         â–¼
Workflow completes, returns result to MozaiksCore


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  3. RUNTIME (Workflow â†’ App)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MozaiksAI Runtime executing a workflow
         â”‚
         â–¼
Workflow needs to interact with app data:
  - Update database
  - Call app API
  - Trigger app function
         â”‚
         â–¼
Workflow makes HTTP call to MozaiksCore app:
  POST https://user-app.example.com/api/tasks
  Authorization: Bearer <app-token>
  {
    "action": "create",
    "task": { "title": "Follow up", "assignee": "user789" }
  }
         â”‚
         â–¼
MozaiksCore app handles request, returns response
         â”‚
         â–¼
Workflow continues execution
```

### The Connection Contract (API)

**MozaiksCore â†’ MozaiksAI (Trigger Workflow)**
```javascript
// In user's app code (running on MozaiksCore)
import { workflowClient } from '@mozaiks/core-runtime';

async function onTaskCreated(task) {
  // Trigger workflow on MozaiksAI runtime
  await workflowClient.execute({
    workflow: 'send-notification',
    data: { taskId: task.id, userId: task.userId }
  });
}
```

**MozaiksAI â†’ MozaiksCore (Call App API)**
```yaml
# In user's workflow definition (running on MozaiksAI)
name: Send Notification Workflow
trigger: task.created
steps:
  - call_app_api:
      endpoint: /api/notifications
      method: POST
      body:
        message: "Task created: {{ task.title }}"
```

### Plugin System for Both Runtimes

**MozaiksCore Plugins (Payment/Marketing)**
```javascript
// User's app can optionally use Mozaiks proprietary services
import { mozaiksPay, mozaiksMarketing } from '@mozaiks/core-runtime/plugins';

// Create subscription (uses Mozaiks Payment system)
await mozaiksPay.createCheckout({
  planId: 'pro-plan',
  userId: currentUser.id
});

// Run ad campaign (uses Mozaiks ValidationEngine)
await mozaiksMarketing.createCampaign({
  name: 'Launch Campaign',
  platforms: ['meta', 'google'],
  budget: 1000
});
```

**MozaiksAI Plugins (Custom Workflows)**
```yaml
# User creates custom workflow that uses Mozaiks tools
name: My Custom Workflow
steps:
  - use_mozaiks_tool:
      tool: validation_engine  # Mozaiks proprietary
      action: create_campaign
```

### Where They Run (Deployment Architecture)

**Managed Mode (Mozaiks-Hosted):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mozaiks Infrastructure (You Host)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  MozaiksAI Runtime                                          â”‚
â”‚  â”œâ”€â”€ Your 5 proprietary workflows                          â”‚
â”‚  â””â”€â”€ User's custom workflows                               â”‚
â”‚                                                             â”‚
â”‚  User's App (MozaiksCore Runtime)                          â”‚
â”‚  â”œâ”€â”€ User's generated frontend/backend                     â”‚
â”‚  â””â”€â”€ MozaiksCore SDK (with Mozaiks plugins enabled)        â”‚
â”‚                                                             â”‚
â”‚  Mozaiks Backend (.NET)                                     â”‚
â”‚  â”œâ”€â”€ Auth, Payment, ValidationEngine, etc.                 â”‚
â”‚  â””â”€â”€ Provides services to MozaiksCore plugins              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Self-Hosted Mode (User's Infrastructure):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User's Infrastructure (They Host)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  MozaiksAI Runtime (open-source)                           â”‚
â”‚  â””â”€â”€ User's custom workflows                               â”‚
â”‚                                                             â”‚
â”‚  User's App (MozaiksCore Runtime)                          â”‚
â”‚  â”œâ”€â”€ User's generated frontend/backend                     â”‚
â”‚  â””â”€â”€ MozaiksCore SDK (Mozaiks plugins DISABLED)            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ (Optional: Connect to Mozaiks services)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mozaiks SaaS (You Host) - Optional                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Mozaiks Backend (.NET) API Gateway                         â”‚
â”‚  â”œâ”€â”€ Payment API (if user wants Mozaiks billing)           â”‚
â”‚  â””â”€â”€ ValidationEngine API (if user wants Mozaiks marketing)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Configuration: Connecting the Runtimes

**In user's generated app (.env file):**
```bash
# MozaiksCore configuration
MOZAIKS_MODE=managed  # or "self-hosted"

# MozaiksAI connection (for triggering workflows)
MOZAIKS_AI_URL=https://mozaiks-ai.example.com
MOZAIKS_AI_TOKEN=<workflow-execution-token>

# Mozaiks services (optional plugins)
MOZAIKS_PAYMENT_ENABLED=true
MOZAIKS_PAYMENT_API_URL=https://api.mozaiks.com/payment
MOZAIKS_MARKETING_ENABLED=true
MOZAIKS_MARKETING_API_URL=https://api.mozaiks.com/validation
```

### The Answer to Your Question

| Question | Answer |
|----------|--------|
| **When do they connect?** | Build time (generation) + Runtime (API calls) |
| **Where do they connect?** | Via HTTP APIs (REST/WebSocket) |
| **How do they connect?** | MozaiksCore SDK has `workflowClient`, workflows call app APIs |
| **Who initiates?** | Both! App triggers workflows, workflows call app |

### Monetization Strategy (Plugin System)

**What Users Get for Free:**
- âœ… MozaiksAI runtime (open-source)
- âœ… MozaiksCore runtime (open-source)
- âœ… Basic workflow execution
- âœ… Basic app runtime services

**What Users Pay For (Optional Plugins):**
- ğŸ’° MozaiksPay (payment processing)
- ğŸ’° MozaiksMarketing (ValidationEngine ad campaigns)
- ğŸ’° Managed hosting (you host both runtimes)
- ğŸ’° Your proprietary workflows (ValueEngine, etc.)

This is like **Stripe** (payment plugin) + **SendGrid** (email plugin) for your runtime ecosystem!

---
