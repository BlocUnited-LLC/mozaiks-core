################################################################
# 1. Environment & Core (Cloud Native)
################################################################
ENVIRONMENT=production

# Provisioning Agent injects these in Azure Container Apps:
# APP_ID - Unique identifier for this app instance (required in production)
# APP_TIER - Subscription tier: free, pro, enterprise (default: free)
MOZAIKS_APP_ID=
APP_TIER=free

# Port for the HTTP server (Azure Container Apps expects 8080)
PORT=8080

################################################################
# 2. Azure & Secrets
################################################################
AZURE_KEY_VAULT_NAME=agentrepo-secrets
AZURE_TENANT_ID=
AZURE_CLIENT_ID=
AZURE_CLIENT_SECRET=

# Fallback if Key Vault is unavailable or for local dev
OPENAI_API_KEY=

################################################################
# 3. Database (MongoDB)
################################################################
# Local dev/test DB. Docker overrides this to mongodb://mongo:27017
MONGO_URI=mongodb://localhost:27017

# Persistence Collections (App Code Versioning)
MOZAIKS_APP_CODE_DB=MozaiksAI
MOZAIKS_APP_CODE_SNAPSHOTS_COLLECTION=AppCodeSnapshots
MOZAIKS_APP_CODE_PATCHSETS_COLLECTION=AppCodePatchSets

# Persistence Collections (Workflow Exports)
MOZAIKS_EXPORTS_DB=MozaiksAI
MOZAIKS_WORKFLOW_EXPORTS_COLLECTION=WorkflowExports

################################################################
# 4. Backend Integration (Platform API)
################################################################
# URL for the Mozaiks Backend (GitHub Ops, Deployment)
MOZAIKS_BACKEND_URL=http://localhost:3000
# Shared secret for authenticating Runtime -> Backend calls
INTERNAL_API_KEY=

# Max size for code bundles sent to backend (bytes)
MOZAIKS_DEPLOY_MAX_BUNDLE_BYTES=26214400

################################################################
# 5. Container Runtime
################################################################
# Which container backend to use: docker (default), e2b, mock
CONTAINER_RUNTIME=docker

# Note: E2B credentials are app-specific and should be passed
# via ContainerSpec.credentials from mozaiks-app, NOT here.

################################################################
# 6. Logging & Observability
################################################################
# Base directory for all logs
LOGS_BASE_DIR=logs/logs

# File format: true=JSON, false=Text
LOGS_AS_JSON=false
# Clear logs on startup (1=Yes, 0=No)
CLEAR_LOGS_ON_START=1

# Performance Telemetry
MOZAIKS_PERSIST_PERF=1
MOZAIKS_PERF_DEBUG=1

# AG2 (AutoGen) Runtime Logging
AG2_RUNTIME_LOGGING=true
AG2_RUNTIME_LOGGER_TYPE=sqlite
AG2_RUNTIME_LOG_FILE=logs/logs/ag2_runtime.log

# GroupChat Debugging
GROUPCHAT_DEBUG=true

################################################################
# 7. Caching & Seeds
################################################################
# Tool Cache: 1=Clear on start (Dev), 0=Keep (Prod)
CLEAR_TOOL_CACHE_ON_START=1
# LLM Config Cache TTL (0 = disable)
LLM_CONFIG_CACHE_TTL=0

# Deterministic Seed (set ONE)
LLM_DEFAULT_CACHE_SEED=178
# RANDOMIZE_DEFAULT_CACHE_SEED=1

################################################################
# 8. Context & Features
################################################################
CONTEXT_AWARE=true
CONTEXT_INCLUDE_SCHEMA=true
CONTEXT_SCHEMA_DB=MozaiksCore
CONTEXT_VERBOSE_DEBUG=1

# Monetization & Billing
MONETIZATION_ENABLED=true
FREE_TRIAL_ENABLED=true
TOKENS_API_URL=http://localhost:5000
TOKEN_WARNING_THRESHOLD=0.2

################################################################
# 9. Uploads & Attachments
################################################################
CHAT_ATTACHMENTS_ALLOWED_WORKFLOWS=AgentGenerator
UPLOAD_STORAGE_DIR=uploads
UPLOAD_MAX_BYTES=26214400
UPLOAD_BUNDLE_MAX_BYTES=10485760
AGENTGEN_ATTACHMENTS_ALLOW_BUNDLING=false

################################################################
# 10. Miscellaneous / Legacy
################################################################
CHAT_START_IDEMPOTENCY_SEC=15
AGENT_CONV_JSON_MAX_LEN=0
MCP_REGISTRY_ENABLE_API=false

################################################################
# 11. JWT Authentication (OIDC Discovery)
################################################################
# Enable/disable JWT authentication (set false for local dev)
AUTH_ENABLED=false

# OIDC Discovery (recommended - provider-agnostic)
# Discovery URL is computed as: {AUTHORITY}/{TENANT_ID}/v2.0/.well-known/openid-configuration
MOZAIKS_OIDC_AUTHORITY=https://mozaiks.ciamlogin.com
MOZAIKS_OIDC_TENANT_ID=9d0073d5-42e8-46f0-a325-5b4be7b1a38d
# Optional: explicit discovery URL (overrides computed URL)
# MOZAIKS_OIDC_DISCOVERY_URL=

# Override settings (skip OIDC discovery for these if set)
# AUTH_ISSUER=https://...
# AUTH_JWKS_URL=https://...

# Token validation
AUTH_AUDIENCE=api://mozaiks-auth
AUTH_REQUIRED_SCOPE=access_as_user
AUTH_ALGORITHMS=RS256
AUTH_CLOCK_SKEW=120

# Claim mappings
AUTH_USER_ID_CLAIM=sub
AUTH_EMAIL_CLAIM=email
AUTH_ROLES_CLAIM=roles

# Cache TTLs (seconds)
AUTH_JWKS_CACHE_TTL=3600
AUTH_DISCOVERY_CACHE_TTL=86400

# WebSocket token extraction (set true to allow ?access_token= query param)
MOZAIKS_WS_ALLOW_QUERY_TOKEN=false
