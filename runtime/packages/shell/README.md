# MozaiksCore Runtime

<div align="center">

![MozaiksAI Logo](public/mozaik_logo.svg)

**Application runtime system for apps generated by MozaiksAI**

MozaiksCore is the execution environment that runs your generated applications, providing auth, payments, hosting, and data access services out of the box.

---

## What Is MozaiksCore?

MozaiksCore is a **multi-tenant application runtime shell** that:
- Hosts app-specific plugins (business logic)
- Provides end-user authentication (OIDC)
- Enforces subscription-based feature gating
- Brokers AI sessions to MozaiksAI runtime
- Works seamlessly with apps generated by MozaiksAI

**Think of it as:** A FastAPI + React scaffold for plugin-based apps with built-in auth and AI integration.

> **Boundary Note:** MozaiksCore handles **app users only**. Platform billing, hosting, and founder auth are managed by the Mozaiks Control Plane (.NET).

---

## Quick Start

### Install as Dependency

**For Python backends:**
```bash
pip install mozaiks-core-runtime
```

**For JavaScript/TypeScript frontends:**
```bash
npm install @mozaiks/core-runtime
```

### Basic Usage

**Python Example:**
```python
from mozaiks_core_runtime import auth, db, payments

@auth.require_user
def create_task(request):
    user = auth.current_user()
    task = db.tasks.create(
        title=request.data['title'],
        owner=user.id
    )
    return {"id": task.id, "title": task.title}
```

**TypeScript Example:**
```typescript
import { auth, db, payments } from '@mozaiks/core-runtime';

export async function createTask(request: Request) {
  const user = await auth.currentUser();
  const task = await db.tasks.create({
    title: request.body.title,
    owner: user.id
  });
  return { id: task.id, title: task.title };
}
```

---

## Features

### ğŸ” Built-in Authentication
- JWT-based auth with OIDC support
- User management APIs
- External IdP integration (Keycloak, Auth0, Okta)
- Role-based access control

### ğŸ’³ Subscription Gating
- Feature gating by subscription tier
- Plugin access control
- Subscription state enforcement
- Billing delegated to Mozaiks Control Plane (MozaiksPay)

### ğŸ“Š Analytics & Insights
- Automatic KPI tracking
- Usage metrics
- Performance monitoring
- Custom event logging

### ğŸš€ Deployment Modes
- Platform-hosted (Mozaiks-managed)
- Self-hosted (your infrastructure)
- External auth (your IdP)
- Environment detection

### ğŸ”Œ Plugin System
- Extend functionality without forking
- Plugins loaded from `MOZAIKS_FRONTEND_PLUGINS_PATH`
- See [Plugin Development Guide](docs/PluginDevelopmentGuide.md) for examples

---

## Architecture

```
Your Generated App
â”œâ”€â”€ frontend/              â† React/Next.js
â”‚   â””â”€â”€ Uses: @mozaiks/core-runtime (npm)
â”‚
â”œâ”€â”€ backend/               â† Python/Node.js
â”‚   â””â”€â”€ Uses: mozaiks-core-runtime (pip)
â”‚
â””â”€â”€ Runs on: MozaiksCore Runtime Environment
    â”œâ”€â”€ Auth Service
    â”œâ”€â”€ Payment Service
    â”œâ”€â”€ Database Layer
    â””â”€â”€ Hosting Manager
```

**MozaiksCore vs MozaiksAI:**
- **MozaiksAI** = Workflow runtime (generates your app)
- **MozaiksCore** = App runtime (executes your app)

### How MozaiksCore Interacts With MozaiksAI

MozaiksCore and MozaiksAI usually coexist in the same product, but they run at different times for different jobs:

- **Build-time (generation):** MozaiksAI runs workflows that generate or modify an app codebase that targets MozaiksCore conventions/SDK.
- **Run-time (execution):** the generated app runs on MozaiksCore; MozaiksAI is not required for normal app execution.
- **Optional â€œlive assistantâ€ UX:** if your product embeds MozaiksAIâ€™s ChatUI, the **frontend typically uses WebSockets (or SSE)** to stream tokens/events from the MozaiksAI runtime. That WebSocket is **between the browser and MozaiksAI**, not between MozaiksCore and MozaiksAI.

In most deployments, **MozaiksCore â†” MozaiksAI** is a backend-to-backend integration over **HTTP** (start job, poll status, fetch artifacts), while WebSockets are reserved for the interactive chat experience.

See also: `docs/AIRuntimeIntegration.md` and `docs/MozaiksAI_Build_Deploy_Runtime_Contract.md`.

---

## Plugin Development

MozaiksCore uses a plugin architecture to extend functionality.

### Example: Hello World Plugin

```python
# backend/plugins/my-plugin/logic.py
from typing import Dict, Any

class MyPlugin:
    def __init__(self, config: Dict[str, Any] = None):
        self.config = config or {}
    
    def on_init(self, app_context: Any) -> None:
        """Called when app starts"""
        print("MyPlugin initialized")
    
    def on_request(self, request_data: Dict[str, Any]) -> Dict[str, Any]:
        """Called on each request"""
        return {"plugin": "my-plugin", "status": "active"}
```

See [Plugin Development Guide](docs/PluginDevelopmentGuide.md) for complete examples.

---

## Deployment Modes

### Managed Hosting (Mozaiks)
```bash
# Your app runs on Mozaiks infrastructure
# No DevOps required - just deploy
```

### Self-Hosted (Your Infrastructure)
```bash
# Deploy to your own servers
docker run -p 8080:8080 \
  -e MOZAIKS_AUTH_URL=https://api.mozaiks.com \
  -e MOZAIKS_PAYMENT_URL=https://pay.mozaiks.com \
  your-app:latest
```

### Bring Your Own Cloud (BYOC)
```bash
# Deploy to your Azure/AWS/GCP
# Connect to Mozaiks services for auth/payments
```

---

## Configuration

**Environment Variables:**

```bash
# Authentication
MOZAIKS_AUTH_URL=https://api.mozaiks.com
MOZAIKS_APP_ID=your-app-id

# Payments
MOZAIKS_PAYMENT_URL=https://pay.mozaiks.com

# Database
DATABASE_URL=mongodb://localhost:27017/myapp

# Hosting
HOSTING_MODE=managed|self-hosted|byoc
```

---

## Development

### Local Setup

```bash
# Clone the repo
git clone https://github.com/BlocUnited-LLC/mozaiks-core.git
cd mozaiks-core

# Install dependencies
pip install -r requirements.txt
npm install

# Run tests
pytest backend/tests/
npm test

# Start development server
python backend/main.py
```

### Project Structure

```
mozaiks-core/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ core/              â† Core runtime services
â”‚   â”œâ”€â”€ plugins/           â† Example plugins
â”‚   â””â”€â”€ tests/             â† Backend tests
â”‚
â”œâ”€â”€ src/                   â† Frontend runtime (TypeScript)
â”‚   â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ core/
â”‚   â””â”€â”€ plugins/
â”‚
â”œâ”€â”€ docs/                  â† Documentation
â””â”€â”€ README.md              â† This file
```

---

## Contributing

We welcome contributions! See [CONTRIBUTING.md](./CONTRIBUTING.md) for guidelines.

### Ways to Contribute

- ğŸ› Report bugs
- ğŸ’¡ Suggest features
- ğŸ“ Improve documentation
- ğŸ”Œ Create example plugins
- ğŸ§ª Add tests

---

## Community

- **GitHub:** https://github.com/BlocUnited-LLC/mozaiks-core
- **Discord:** [Join our community](#)
- **Docs:** [docs.mozaiks.com](#)
- **Issues:** [GitHub Issues](https://github.com/BlocUnited-LLC/mozaiks-core/issues)

---

## License

MIT License - see [LICENSE](./LICENSE) for details.

---

## Related Projects

- **MozaiksAI** - AI workflow runtime that generates apps (uses MozaiksCore)
- **Mozaiks Platform** - Full-featured SaaS platform for building/hosting apps

---

**Built with â¤ï¸ by the Mozaiks Team**
